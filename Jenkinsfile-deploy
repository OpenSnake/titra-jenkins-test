pipeline {
  agent ansible

  stages {
    stage('Checkout') {
        steps {
          git 'https://github.com/OpenSnake/titra-test.git'
            }
        }

    stage('Download Artifact') {
      steps {
        copyArtifacts(
          projectName: 'build',
          selector: lastSuccessful(),
          filter: 'build.tar.gz',
          target: '.ansible/'
        )
      }
    }

    stage('Deploy') {
      steps {
        sh 'ansible-playbook .ansible/playbook.yaml --vault-password-file secret_password'
      }
    }

  }
}
