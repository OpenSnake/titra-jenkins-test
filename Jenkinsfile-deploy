pipeline {
  agent {label 'node'}

  stages {
    stage('Checkout') {
        steps {
          git 'https://github.com/OpenSnake/titra.git'
            }
        }

    stage('Download Artifact') {
      steps {
        sh '[ ! -e secret_password ] || cp ../../secret_password secret_password'
        sh '[ -e .ansible/titra.tar.gz ] || rm .ansible/titra.tar.gz'
        sh 'cp ../build.tar.gz .ansible/titra.tar.gz'
      }
    }

    stage('Deploy') {
      steps {
        sh 'cd .ansible && ansible-playbook playbook.yaml --vault-password-file ../secret_password'
      }
    }

  }
}
